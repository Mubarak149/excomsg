{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exams</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
   <!-- Option 1: Include in HTML -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{% static 'staff/css/style.css' %}">
  <style>
    .avatar{
      border-radius: 50%;
      width: 50px;
      height: 50px;
    }
    
    .status-dot {
        height: 10px;
        width: 10px;
        border-radius: 50%;
        display: inline-block;
        margin-left: 5px;
    }

    .online {
        background-color: green;
    }

    .offline {
        background-color: red;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark position-fixed" style="width: 100%; height: 15vh; top: 0; z-index: 1;">
        <div class="container-fluid">
          
          <a class="navbar-brand  fw-bold text-uppercase me-auto"  href="{%url 'adminHome'%}">Excellent Community School Giwa</a>
         
        </div>
      </nav>

      <!-- Navbar -->
 
      <!-- main section -->


<section class="mt-5 p-3">
  <div class="containers my-5">

    <!--  allstudents start -->

    <div class="container mt-5" id="studentTableSection" >
      <div class="row mb-3">
          <div class="col-md-6 mb-3">
              <input type="text" id="searchInput" class="form-control" placeholder="Search by any field...">
          </div>
          <div class="col-md-6 mb-3">
              <select id="filterSelect" class="form-select">
                  <option value="">Filter by</option>
                  <option value="subject">Subject</option>
                  <option value="term">Term</option>
                  <option value="Date">Date</option>
                  <option value="class">Class</option>
                  <option value="score">Total Grade</option>
                  <option value="year">Year</option>
                  
              </select>
          </div>
      </div>
      <table class="table table-responsive w-50-sm table-striped">
          <thead>
              <tr>
                  <th>Avatar</th>
                  <th>Subject</th>
                  <th>Date</th>
                  <th>Term</th>
                  <th>Year</th>
                  <th>Class</th>
                  <th>Total Grade</th>
              </tr>
          </thead>
          <tbody id="gradeTable">
              <!-- Student data will be populated here -->
          </tbody>
      </table>
  </div>
    <!-- allstudents end -->


</section>


      <!-- main section -->

      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script>
        function showSection(section) {
    ['classes'].forEach(sec => {
        document.getElementById(sec).style.display = 'none';
    });
    
    document.getElementById(section).style.display = 'block';
}


// students table logic start

document.addEventListener('DOMContentLoaded', function () {
  const theGrades = {{grades|safe}}
  const studentTable = document.getElementById('gradeTable');
  const searchInput = document.getElementById('searchInput');
  const filterSelect = document.getElementById('filterSelect');
  const teacherSubjects = {{teacher_subjects|safe}}
  console.log(teacherSubjects[0].teacher_subjects);
  const urls = {
    updateurl: "{% url 'updateStudentGrades' 0 %}".replace('/0/', '/'),
}; 

  function populateTable(data) { 
      studentTable.innerHTML = data.map(grade => `
          <tr>
              <td><img src="${grade.avatar}" class="avatar" alt="avatar">
                ${grade.score < 1 ? 
                  '<span class="status-dot offline"></span>' : 
                  '<span class="status-dot online"></span>'
              }
              </td>
              <td>${grade.subject}</td>
              <td>${grade.Date}</td>
              <td>${grade.term}</td>
              <td>${grade.year}</td>
              <td>${grade.class}</td> 
              <td><h3>${grade.score}</h3></td>
              <td>
                ${teacherSubjects[0].teacher_subjects.includes(grade.subject_id)? 
                  `<a href="${urls.updateurl}${grade.id}/" class="btn btn-success btn-sm">
                    Edit Exam
                  </a>` : 
                  `<a href="#" class="btn btn-dark btn-sm">
                    Seen
                  </a>`
              }
                
              </td>
             
          </tr>
      `).join('');
  }

  function filterTable() {
      const searchText = searchInput.value.toLowerCase();
      const filterBy = filterSelect.value;
      const filteredGrades = theGrades.filter(grade => {
        if (!filterBy) {
            // If no filter is selected, search across all fields
            return Object.keys(grade).some(key => 
                grade[key].toString().toLowerCase().includes(searchText)
            );
        } else {
            // If a filter is selected, search within that specific field
            return grade[filterBy].toString().toLowerCase().includes(searchText);
        }
      });
      populateTable(filteredGrades);
  }

  searchInput.addEventListener('input', filterTable);
  filterSelect.addEventListener('change', filterTable);

  populateTable(theGrades); // Initial population of the table
});
// students table logic end

    </script>
</body>
</html>