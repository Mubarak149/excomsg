<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Student Result</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="teacher_dashboard/css/style.css">
    <style>
        .avatar {
            width: 50px;
            border-radius: 50%;
            border: 1px solid rgb(21, 82, 21);
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark position-fixed" style="width: 100%; top: 0; height: auto; z-index: 1; place-items: center;">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold text-uppercase me-auto" href="{%url 'main' %}">Excellent Community School Giwa</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>
    <!-- Navbar -->

    <!-- All Students Start -->
    <div class="container mt-5 p-5 w-md-75" id="studentTableSection">
        <div class="row mb-3">
            <div class="col-md-6 mb-3 pt-sm-2">
                <input type="text" id="searchInput" class="form-control" placeholder="Search by any field...">
            </div>
            <div class="col-md-6 mb-3 pt-sm-2">
                <select id="filterSelect" class="form-select">
                    <option value="">Filter by</option>
                    <option value="student">Name</option>
                    <option value="promoted_class">New Class</option>
                    <option value="promotion_date">Promotion Date</option>
                    <option value="promoted_score">Score</option>
                    <option value="is_promoted">Status</option>
                    <option value="promotion_year">Year</option>
                </select>
            </div>
        </div>
        <div class="class-name m-4 p-2">
            <a href="{%url 'viewStudent' student %}"  class="btn btn-dark btn-sm" role="button">Back to dashboard</a>
            <h4 id="classTitle">Default Class</h4>
        </div>
        <table class="table table-responsive table-striped">
            <thead>
                <tr>
                    <th>Avatar</th>
                    <th>Name</th>
                    <th>New Class</th>
                    <th>Date</th>
                    <th>Score</th>
                    <th>Year</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="studentTable">
                <!-- Student data will be populated here -->
            </tbody>
        </table>
    </div>
    <!-- All Students End -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            const promotionRecords = JSON.parse('{{ promotion_records_json|escapejs }}');
        
            const studentTable = document.getElementById('studentTable');
            const searchInput = document.getElementById('searchInput');
            const filterSelect = document.getElementById('filterSelect');
            const classNameHeader = document.getElementById('classTitle');
    
            // Dynamically set the class name based on the first record's promoted_class
            if (promotionRecords.length > 0) {
                classNameHeader.textContent = promotionRecords[0].promoted_class;
            }
        
            function populateTable(data) {
                studentTable.innerHTML = data.map(record => {
                    return `
                        <tr>
                            <td><img src="${record.pic}" class="avatar" alt="avatar">
                            <span class="status-dot ${record.is_promoted ? 'online' : 'offline'}"></span>
                            </td>
                            <td>${record.student}</td>
                            <td>${record.promoted_class}</td>
                            <td>${record.promotion_date}</td>
                            <td>${record.promoted_score}</td>
                            <td>${record.promotion_year}</td>
                            <td>
                                ${record.is_promoted ? 
                                    `<button class="btn btn-success btn-sm">True</button>` : 
                                    `<button class="btn btn-dark btn-sm">False</button>`
                                }
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        
            function filterTable() {
                const searchText = searchInput.value.toLowerCase();
                const filterBy = filterSelect.value;
                const filteredRecords = promotionRecords.filter(record => {
                    if (!filterBy) {
                        return Object.keys(record).some(key => {
                            return record[key].toString().toLowerCase().includes(searchText);
                        });
                    } else {
                        return record[filterBy].toString().toLowerCase().includes(searchText);
                    }
                });
                populateTable(filteredRecords);
            }
        
            searchInput.addEventListener('input', filterTable);
            filterSelect.addEventListener('change', filterTable);
        
            populateTable(promotionRecords); // Initial population of the table
        });
        </script>
        
</body>
</html>
