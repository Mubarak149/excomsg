{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class and Student Details</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
 <!-- Navbar -->
 <nav class="navbar navbar-expand-lg navbar-dark bg-dark position-fixed" style="width: 100%; top: 0; z-index: 1;">
    <div class="container-fluid">
      <button class="navbar-toggler me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
        <span class="navbar-toggler-icon"></span>
      </button>
      

      <a class="navbar-brand  fw-bold text-uppercase me-auto" href="{% url 'adminHome' %}">Admin Dashboard</a>
      
      

        <li class="nav-item dropdown ms-auto">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              <i class="bi bi-person-circle fs-5"></i>
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
              <li class="nav-item"><a class="dropdown-item" href="{% url 'adminProfile' user.admin.id%}">my profile</a></li>
              <li class="nav-item"><a class="dropdown-item" href="{% url 'adminSetting' %}">settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li class="nav-item"><a class="dropdown-item" href="{% url 'logout' %}">Logout</a></li>
            </ul>
          </li>
      </div>
    </div>
  </nav>

<div class="container mt-5">
    <div class="row mt-5 pt-5" id="classCards">
        <!-- Bootstrap Cards will be inserted here -->
    </div>
</div>
 
<script type="text/javascript">
    const students = {{ student_json|safe }};
 
    // Function to group students by class
    const groupByClass = (students) => {
        return students.reduce((result, student) => {
            (result[student.class_name] = result[student.class_name] || []).push(student);
            return result;
        }, {});
    };
 
    const classes = groupByClass(students);
 
    // Function to generate PDF
    const generatePDF = (className, studentList) => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
 
     doc.setFontSize(20)
     doc.text('Excellent Community School Students List', 55, 10)
 
 
        const logoImg = "{% static 'assets/images/schoollogo.jpg'%}";  
        const logoWidth = 40;  
        const logoHeight = 30; 
 
    // Add the logo to the PDF at position (5,5)
    doc.addImage(logoImg, 'JPEG', 5, 5, logoWidth, logoHeight);
 
 
        doc.setFontSize(16);
        doc.text(`Class: ${className}`, 15, 35);
        doc.text(`Number of students: ${studentList.length}`, 15, 45);
 
        // Add student details to the PDF
        const tableRows = studentList.map((student, index) => [
            index + 1,
            student.name,
            student.surname,
            student.admission_no,
            student.email
        ]);
 
        doc.autoTable({
            head: [['No', 'First Name', 'Surname', 'Reg Number', 'Email']],
            body: tableRows,
            startY: 60
        });
 
        doc.save(`${className}_students.pdf`);
    };
 
    // Create Bootstrap Cards for each class
    const classCardsContainer = document.getElementById('classCards');
    Object.keys(classes).forEach(className => {
        const studentList = classes[className];
 
        // Create Bootstrap card
        const card = document.createElement('div');
        card.classList.add('col-md-4');
        card.innerHTML = `
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="card-title">Class: ${className}</h5>
                    <p class="card-text">Number of Students: ${studentList.length}</p>
                    <button class="btn btn-primary download-btn">
                        Download PDF
                    </button>
                </div>
            </div>
        `;
 
        // Append the card to the container
        classCardsContainer.appendChild(card);
 
        // Add event listener to the download button
        card.querySelector('.download-btn').addEventListener('click', () => {
            generatePDF(className, studentList);
        });
    });
</script>
 
</body>
</html>